<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>reveal-md</title>
    <link rel="stylesheet" href="./css/reveal.css" />
    <link rel="stylesheet" href="./css/theme/black.css" id="theme" />
    <link rel="stylesheet" href="./css/highlight/gruvbox-dark.css" />
    <link rel="stylesheet" href="./css/print/paper.css" type="text/css" media="print" />

  </head>
  <body>
    <div class="reveal">
      <div class="slides"><section  data-markdown><script type="text/template"># JPA Intro #
## Ocado @ Dzix ##
  
≈Åukasz Burdyna  
</script></section><section  data-markdown><script type="text/template">
# ORM #
Object-Relational Mapping (ORM) is a technique that lets you query and manipulate data from a database using an object-oriented paradigm.
</script></section><section  data-markdown><script type="text/template">
# JPA #

The Java Persistence API is a specification for: 
* accessing
* persisting
* managing 

data between Java objects / classes and a relational database 
</script></section><section  data-markdown><script type="text/template">
# Just specification #
JPA itself is just a specification, not a product.  
It cannot perform any actions itself.  
JPA is just a set of interfaces and  
**requires an implementation**
</script></section><section  data-markdown><script type="text/template">
# Provider #

In order to work with JPA a provider is needed.
Providers and their popularity:
* Hibernate ~72%
* EclipseLink ~13%
* OpenJpa ~2%
* other/none ~13%

(by [Vlad Mihalcea](https://twitter.com/vlad_mihalcea/status/764515904965279744?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E764515904965279744&ref_url=https%3A%2F%2Fvladmihalcea.com%2Fjpa-providers-market-share-in-2016%2F) in 2016)
</script></section><section  data-markdown><script type="text/template">
# Plain JPA #
![persistence.xml](persistenceFile.png)
</script></section><section  data-markdown><script type="text/template">
# Spring with JPA #
Spring Data JPA makes it easy to easily implement JPA based repositories.  
This module deals with enhanced support for JPA based data access layers.
</script></section><section  data-markdown><script type="text/template">
# POJO
```java
public class Author {

	private String firstName;
	private String lastName;

	// Constructors, getters and setters..
```
<aside class="notes"><p>JavaBean convention</p>
</aside></script></section><section  data-markdown><script type="text/template">
## Entity ##

```java
@Entity 
public class Author {

	@Id 
	@GeneratedValue(strategy = GenerationType.AUTO)
	private Long id;

	private String firstName;
	private String lastName;

 	public Author() {
	}
	// Constructors, getters and setters..
```

<aside class="notes"><p>A primary key field that is set by the application can have one of the following types:
    boolean, byte, short, char, int, long, float, double
    Byte, Short, Character, Integer, Long, Float, Double.
    math.BigInteger, math.BigDecimal, String,
    util.Date, sql.Date, sql.Time, sql.Timestamp.
    Any enum type.
    Reference to an entity object.</p>
</aside></script></section><section  data-markdown><script type="text/template">
## SQL generated by Hibernate ##


```sql
Hibernate:
create table Author(
	id bigint generated by default as identity,
	firstName varchar(255),
	lastName varchar(255),
	primary key (id)
)
```
</script></section><section  data-markdown><script type="text/template">
## Spring/Hibernate ddl-auto ##

```xml
spring.jpa.hibernate.ddl-auto=
```
* validate - validate the schema, makes no changes to the database
* update - update the schema
* create - creates the schema, destroying previous data
* create-drop - drop the schema at the end of the session

<aside class="notes"><p>schema.sql and data.sql
Migrations - Flyway or Liquibase</p>
</aside></script></section><section  data-markdown><script type="text/template">
## Column definition ##

```java
@Table(name = "AUTHORS")
public class Author {
	@Enumerated(EnumType.STRING)
	private SomeEnum enumField;

	@Column(name = "last_name", 
		nullable = true, 
		unique = false, 
		insertable = true, 
		updatable = true, 
		length = 255)
	private String lastName;
```

<aside class="notes"><p>EnumType.ORDINAL</p>
</aside></script></section><section  data-markdown><script type="text/template">
## Field vs getter
```java
@Column(name = "SAMPLE_STRING")  
private String sampleString;

public String getSampleString(){  
  return sampleString;  
}
```
<!-- .element: class="fragment" data-fragment-index="0" -->
vs
<!-- .element: class="fragment" data-fragment-index="1" -->
```java
private String sampleString;

@Column(name = "SAMPLE_STRING")  
public String getSampleString(){  
  return sampleString;  
}  
```
<!-- .element: class="fragment" data-fragment-index="1" -->
<aside class="notes"><p>Use only one convention or use 
@AccessType(PROPERTY / FIELD)</p>
</aside></script></section><section  data-markdown><script type="text/template">
## EntityManager ## 
EntityManager is the entry point for your entities.

* find
* persist
* merge
* refresh
* remove
* flush

<aside class="notes"><p>Refresh - refresh the state of the instance from the database, overwriting changes made to the entity, if any.</p>
</aside></script></section><section  data-markdown><script type="text/template">
## Entity Transaction ##
```java
var transaction = entityManager.getTransaction();
transaction.begin();
// do important things here...
transaction.commit();
transaction.rollback();
```
Spring
```java
@Transactional(rollbackFor = SomethingWentWrongException.class)
```
</script></section><section  data-markdown><script type="text/template">
## Managed vs detached entity ##

* Managed
* Detached

![Managed vs detached](entity.png)

<aside class="notes"><p>insert sth cos it&#39;s important</p>
</aside></script></section><section  data-markdown><script type="text/template">
## Spring repositories ##

Interfaces to use with Spring Data:
* CrudRepository
* PagingAndSortingRepository
* JpaRepository

<aside class="notes"><p>JpaRepository provides some JPA-related methods such as flushing the persistence context and deleting records in a batch.</p>
</aside></script></section><section  data-markdown><script type="text/template">
## Inheritance ##

```java
@MappedSuperclass
@Inheritance(strategy = InheritanceType.TABLE_PER_CLASS)
@Inheritance(strategy = InheritanceType.SINGLE_TABLE)
@Inheritance(strategy = InheritanceType.JOINED)
```
<aside class="notes"><p>Mapped Superclass - only visible in JVM, derived entities are mapped to full tables along with superclass fields
Table per class - a single table is created for each entity with only it&#39;s fields
Single table - one table for every entity type (all fields in one table) - @DiscriminatorColumn @DiscriminatorValue
Joined - Superclass is mapped to a table, other entities have coresponding tables with specific fields</p>
</aside></script></section><section  data-markdown><script type="text/template">
## Associations ##

```java
@OneToOne(cascade = Cascade, fetch = FetchType, mappedby = )
@OneToMany
@ManyToOne
@ManyToMany
```

<aside class="notes"><p>OneToOne, ManyToOne - JoinColumn, Eager<br>OneToMany, ManyToMany - JoinTable, Lazy</p>
</aside></script></section><section  data-markdown><script type="text/template">
## Cascade ##
* persist
* merge
* refresh
* remove
* detach
* all
</script></section><section  data-markdown><script type="text/template">

## Fetch type ##

* EAGER
* LAZY
</script></section><section  data-markdown><script type="text/template">
## Queries ##

```java
@Query("SELECT c FROM Client c 
	WHERE c.status = :status and c.name = :name")
Client findClientByStatusAndName(
  @Param("status") Integer status, 
  @Param("name") String name);
```
is equal to

```java
@Query("SELECT c FROM User c 
	WHERE c.status = ?1 and c.name = ?2")
Client findClientByStatusAndName(Integer status, String name);
```
</script></section><section  data-markdown><script type="text/template">
Thanks</script></section></div>
    </div>

    <script src="./lib/js/head.min.js"></script>
    <script src="./js/reveal.js"></script>

    <script>
      function extend() {
        var target = {};
        for (var i = 0; i < arguments.length; i++) {
          var source = arguments[i];
          for (var key in source) {
            if (source.hasOwnProperty(key)) {
              target[key] = source[key];
            }
          }
        }
        return target;
      }

      // Optional libraries used to extend on reveal.js
      var deps = [
        { src: './lib/js/classList.js', condition: function() { return !document.body.classList; } },
        { src: './plugin/markdown/marked.js', condition: function() { return !!document.querySelector('[data-markdown]'); } },
        { src: './plugin/markdown/markdown.js', condition: function() { return !!document.querySelector('[data-markdown]'); } },
        { src: './plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
        { src: './plugin/zoom-js/zoom.js', async: true },
        { src: './plugin/notes/notes.js', async: true },
        { src: './plugin/math/math.js', async: true }
      ];

      // default options to init reveal.js
      var defaultOptions = {
        controls: true,
        progress: true,
        history: true,
        center: true,
        transition: 'default', // none/fade/slide/convex/concave/zoom
        dependencies: deps
      };

      // options from URL query string
      var queryOptions = Reveal.getQueryHash() || {};

      var options = extend(defaultOptions, {}, queryOptions);
    </script>


    <script>
      Reveal.initialize(options);
    </script>
  </body>
</html>
